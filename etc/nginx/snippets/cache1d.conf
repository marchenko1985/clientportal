# Cache upstream responses for 1 day.
# Used for slow-changing data: /v1/api/iserver/secdef/search results.
proxy_cache       cache;
proxy_cache_valid 200 1d;               # Only cache HTTP 200 (errors are never cached)
proxy_cache_key   "$request_uri";       # Different query strings = separate cache entries
proxy_cache_lock  on;                   # One request fills cache; others wait (prevents stampede)

# Restore security headers: the add_header below blocks server-level add_header inheritance.
# See snippets/security-headers.conf for the full explanation.
include /etc/nginx/snippets/security-headers.conf;

# HIT=served from cache, MISS=upstream queried, EXPIRED=re-fetched, BYPASS=cache skipped
add_header X-Cache-Status $upstream_cache_status always;
