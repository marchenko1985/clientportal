# Shared proxy settings for HTTP requests to backend services.
# IMPORTANT: No proxy_pass here. Each location must set its own proxy_pass.
# This lets the snippet be reused for both gateway and feed locations.

proxy_http_version 1.1;
proxy_set_header Connection "";                              # Clear hop-by-hop headers; enables keepalive
proxy_set_header Host              $host;                   # ASP.NET Core needs real Host for link gen
proxy_set_header X-Real-IP         $remote_addr;
proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;                 # Needed by UseForwardedHeaders for HTTPS detection

proxy_connect_timeout  5s;
proxy_send_timeout    30s;
proxy_read_timeout   120s;   # Must exceed worst-case rate-limit queue: burst=1000/rate=10r/s = 100s
