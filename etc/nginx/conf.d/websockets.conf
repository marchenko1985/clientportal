# Maps the Upgrade header to the correct Connection value for WebSocket proxying.
# When Upgrade: websocket is present → Connection: upgrade (required for WS handshake).
# When no Upgrade header → Connection: close (prevent hop-by-hop header leakage).
map $http_upgrade $connection_upgrade {
    default  upgrade;
    ''       close;
}
